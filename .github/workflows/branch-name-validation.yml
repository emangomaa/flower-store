name: Branch Name Validation (On Branch Create)

on:
  create:
    branches:
      - '**'  # trigger on all created branches

jobs:
  validate-branch:
    runs-on: ubuntu-latest

    if: >
      github.ref_type == 'branch' &&
      github.ref != 'refs/heads/main' &&
      github.ref != 'refs/heads/development' # exclude main & development

    steps:
      - name: Extract branch name
        run: echo "BRANCH_NAME=${GITHUB_REF#refs/heads/}" >> $GITHUB_ENV

      - name: Validate branch name
        env:
          BRANCH_NAME: ${{ env.BRANCH_NAME }}
        run: |
          echo "üîç Validating branch: $BRANCH_NAME"

          # Allowed prefixes:
          # feature/, bugfix/, hotfix/, release/
          # Pattern: prefix/TICKET-CODE-NUMBER/task-name

          REGEX="^(feature|bugfix|hotfix|release)\/[A-Z]+-[0-9]+-[A-Za-z0-9._-]+$"

          if [[ ! "$BRANCH_NAME" =~ $REGEX ]]; then
            echo "‚ùå Invalid branch name format!"
            echo "Branch must follow:"
            echo "{prefix}/{TICKET-ID}-{NUMBER}-{task-name}"
            echo ""
            echo "Example: feature/ECOM-27-Initialize-Project"
            exit 1
          fi

          echo "‚úÖ Branch name format is valid!"
